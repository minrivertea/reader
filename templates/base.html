{% load django_static %}

<!DOCTYPE html>
<html lang="en">
<head>

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<meta content="en-gb" http-equiv="Content-Language" />
	<meta content="{% block metadescription %}{% endblock %}" name="description" />
	
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="generator" content="Django - http://www.djangoproject.com" />
	<meta name="DC.format" content="text/html" />
	<meta name="DC.type" content="Django Site" />
	<meta name="robots" content="ALL" />
	
	<title>{% block pagetitle %}Chinese Dictionary and Reading Tools{% endblock %} | 看懂了么?</title>	
	<style type="text/css">
	   {% include 'static/styles.txt' %}
	</style>
	
	<link rel='shortcut icon' href="{% staticfile '/images/favicon.ico' %}" type="image/x-icon" />
	
	<script type="text/javascript">
	   {% include 'static/jquery-1.8.2.min.js' %}
	</script>
	
	<script type="text/javascript">
	   {% include 'static/jquery.pjax.js' %}
	</script>
	
	{% block extracss %}{% endblock %}


</head>

<body class="font1">

    <div id="header" class="{% if request.path == '/' %}home{% endif %}">
       <div id="header-inner" class="centred">
        <a href="/" id="logo" data-ajax>KanDongLe.Me?</a>
        
        <a href="{% url page 'about' %}" title="about" data-ajax>about</a>
        {% comment %}
        {% if user.is_authenticated %}
            <a href="{% url user %}">Your account</a>
        {% else %}
           <div href="/" class="expandable register">
                <span class="linktext">Register</span>
                <div class="subnav">
                    <p class="help"><strong>Register to use personalised reading lists, vocabulary and mobile applications.</strong> <br/><br/>We will never pass on your private information to any other individual or company. Your information is stored securely, your password encrypted, and your email will never be displayed publicly. We hate spam just as much as you do!</p>
                    <form method="post" action=".">
                       {% csrf_token %}
                       <p>
                            <input type="text" name="email" id="id_email" value="" title="" class="clearMeFocus"/>
                            <label for="id_email">Your email address</label>
                       </p>
                       <p>
                            <input type="password" name="password1" id="id_password1" value="" class="clearMeFocus"/>
                            <label for="id_password1">Choose a password</label>
                       </p>
                       <input type="submit" value="Register now!" class="register button" />
                     </form>
                </div>
            </div>
           <div href="/" class="expandable login">
                <span class="linktext">Login</span>
                <div class="subnav">
                     <p class="help">If you haven't got an account, <a href="{% url registration_register %}">register here</a> - or did you <a class="forgotten" href="{% url auth_password_reset %}">forget your password?</a>?</p>   

                    <form method="post" action="{% url django.contrib.auth.views.login %}">
                    {% csrf_token %}
                    <p><label for="id_username">eg. john@example.com</label><input id="id_username" type="text" name="username" title="Your username" class="clearMeFocus" maxlength="30" /></p>
                    <p><label for="id_password">Your password</label><input type="password" name="password" id="id_password" title="Your password" class="clearMeFocus" /></p>
                     <input type="submit" value="Login" class="login button" /></p>
                    <input type="hidden" name="next" value="{% if next %}{{ next }}{% else %}/{% endif %}" />
                    </form>                
                 </div>
            </div>
        {% endif %}
        {% endcomment %}
        
    
        <form id="search" data-pjax action="{% url search %}" method="post" class="">
            {% csrf_token %}
            <label for="id_char">Search for a Chinese word</label>
            <input id="id_char" class="clearMeFocus empty" title="Search for a Chinese word" name="char" value="" placeholder="Search for a Chinese word" >
            <input type="submit" value="Go" id="submit" class="submit button"/>
        </form>
      </div>
    </div>
        
    <div id="editable"></div>
        
    <img id="loading" src="/images/loading.gif"/>
    
    <div id="container"> 
        {% block content %}{% endblock %}        
    </div>
    
	<script type="text/javascript">

		$(document).ready( function() {
            
            
            /// IF THIS IS THE HOMEPAGE, GIVE THE HEADER THE 'HOME' CLASS
            function checkHeader() {
            	if (window.location.pathname == '/') {
                    $('#header').addClass('home');  
            	} else {
            	    $('#header').removeClass('home');  
            	}
            }
            
                 
            /// BINDS THE SEARCH FORM TO PJAX        
            $(document).on('submit', '#header form[data-pjax]', function(event) {
                              
               if ($('#id_char').val() == '') {
                    /// HANDLES AN EMPTY SEARCH
                    var url = '/search/';
                    $.pjax({url: url, container: '#container'});
               } else {               
                   /// CONVERT THE FORM INTO A GET REQUEST 
                   var url = '/search/' + $('#id_char').val() + '/';  
                   $.pjax({url: url, container: '#container'}); 
               }
               
               return false;
                          
            });
                
                        
            /// SHOWS THE LOADING SPINNER
            $(document).on('pjax:send', function() {
              $('#container').fadeOut(150);
              $('#loading').show();
              checkHeader();
            });
            
            
            // HIDES THE LOADING SPINNER
            $(document).on('pjax:complete', function() {
              $('#loading').hide();
              $('#container').fadeIn(100);
            });
            
            // MAKES SURE THE HOME PAGE LOADS PROPERLY WITH BACK/FORWARDS CLICKS
            window.onpopstate = function(event) {   
            	checkHeader();
        	}
            
            /// BIND VARIOUS LINK TO PJAX
            $(document).pjax('a, a[data-pjax]', '#container');
            
            /// HELPS AVOID FREQUENT ABORTS CAUSED BY PJAX'S LOW DEFAULT TIMEOUT
            $(document).on('pjax:timeout', function(event) {
              // Prevent default timeout redirection behavior
              event.preventDefault()
            })

            function clearInput() {		
            	$('.clearMeFocus').each( function() {
            	   if ($(this).val() == '') {
            	      var id = $(this).attr('id');
            	      $('label[for="'+id+'"]').show();
            	   }
            	});
            	
            	$('.clearMeFocus').focus(function() {	
            		var id = $(this).attr('id');
            		$('label[for="'+id+'"]').addClass('focus');
            	});
            	
            	// if field is empty afterward, add text again
            	$('.clearMeFocus').blur(function() {
            		var id = $(this).attr('id');
            		
            		if($(this).val()=='') {
            			$('label[for="'+id+'"]').removeClass('focus');
            		}
            	}); 
            	
            	$('.clearMeFocus').keyup( function() {
            	    var id = $(this).attr('id');
            	    if ($(this).val() != '') {
            		  $('label[for="'+id+'"]').hide();
            	    } else {
            	      $('label[for="'+id+'"]').show();
            	    }
            	});  
            }           
		});
		
	</script>
    {% block extrajs %}{% endblock %}	

</body>

</html>
